version: '3.8'

services:
  gateway:
    build:
      context: ..
      args:
        BUILD_VERSION: ${BUILD_VERSION:-dev}
    ports:
      - "8080:80"
    networks:
      - gateway-ipv6
    environment:
      # Domain suffix for routing
      - SERVER_DOMAIN=${SERVER_DOMAIN:-inojob.com}
      # Resolution backend API URL (staging server)
      - BACKEND_URL=${BACKEND_URL:-https://inojob.com/router/api}
      # Cache TTL in seconds
      - CACHE_TTL=${CACHE_TTL:-60}
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost/_health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

networks:
  gateway-ipv6:
    enable_ipv6: true
    ipam:
      config:
        - subnet: "172.28.0.0/16"
        - subnet: "fd00:dead:beef::/48"
